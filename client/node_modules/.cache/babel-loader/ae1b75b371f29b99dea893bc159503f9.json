{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Admin/Desktop/new-ecommerce-main/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Admin/Desktop/new-ecommerce-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Admin/Desktop/new-ecommerce-main/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import React,{useState}from'react';import{useSelector}from'react-redux';import{useNavigate}from'react-router-dom';import{useCreateOrderMutation}from'../services/appApi';import{Row,Col,Alert,Form,Button,Card}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CheckoutForm(){var stripe=useStripe();var elements=useElements();var user=useSelector(function(state){return state.user;});var navigate=useNavigate();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),alertMessage=_useState2[0],setAlertMessage=_useState2[1];var _useCreateOrderMutati=useCreateOrderMutation(),_useCreateOrderMutati2=_slicedToArray(_useCreateOrderMutati,2),createOrder=_useCreateOrderMutati2[0],_useCreateOrderMutati3=_useCreateOrderMutati2[1],isLoading=_useCreateOrderMutati3.isLoading,isError=_useCreateOrderMutati3.isError,isSuccess=_useCreateOrderMutati3.isSuccess;var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),country=_useState4[0],setCountry=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),address=_useState6[0],setAddress=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),paying=_useState8[0],setPaying=_useState8[1];function handlePay(_x){return _handlePay.apply(this,arguments);}function _handlePay(){_handlePay=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$fetch$then,client_secret,_yield$stripe$confirm,paymentIntent,error;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements||user.cart.count==0)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setPaying(true);_context.next=6;return fetch('http://localhost:8080/create-payment',{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({amount:user.cart.total})}).then(function(res){return res.json();});case 6:_yield$fetch$then=_context.sent;client_secret=_yield$fetch$then.client_secret;_context.next=10;return stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(result){// Handle result.error or result.paymentIntent\n// console.log(result);\nreturn result;});case 10:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;error=_yield$stripe$confirm.error;setPaying(false);console.log(error);if(error){setAlertMessage(\"Payment failed: \".concat(error.message));}if(paymentIntent){createOrder({userId:user._id,cart:user.cart,address:address,country:country}).then(function(res){if(!isLoading&&!isError){if(paymentIntent.status==='succeeded'){setAlertMessage(\"Payment \".concat(paymentIntent.status));}setTimeout(function(){navigate('/orders');},2000);}});}case 17:case\"end\":return _context.stop();}}},_callee);}));return _handlePay.apply(this,arguments);}return/*#__PURE__*/_jsx(Col,{className:\"cart-payment-container\",children:/*#__PURE__*/_jsxs(Form,{onSubmit:handlePay,children:[/*#__PURE__*/_jsxs(Row,{children:[alertMessage&&/*#__PURE__*/_jsx(Alert,{children:alertMessage}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"First Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"First Name\",value:user.name,disabled:true})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"email\",placeholder:\"Email\",value:user.email,disabled:true})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Address\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Address\",value:address,onChange:function onChange(e){return setAddress(e.target.value);}})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Country\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Country\",value:country,onChange:function onChange(e){return setCountry(e.target.value);}})]})})]}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card-element\",children:\"Card\"}),/*#__PURE__*/_jsx(CardElement,{id:\"card-element\"}),/*#__PURE__*/_jsx(Button,{className:\"mt-3\",type:\"submit\",disabled:user.cart.count<=0||paying||isSuccess,children:paying?\"Processing...\":\"Pay\"})]})});}export default CheckoutForm;","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useState","useSelector","useNavigate","useCreateOrderMutation","Row","Col","Alert","Form","Button","Card","CheckoutForm","stripe","elements","user","state","navigate","alertMessage","setAlertMessage","createOrder","isLoading","isError","isSuccess","country","setCountry","address","setAddress","paying","setPaying","handlePay","e","preventDefault","cart","count","fetch","method","headers","body","JSON","stringify","amount","total","then","res","json","client_secret","confirmCardPayment","payment_method","card","getElement","result","paymentIntent","error","console","log","message","userId","_id","status","setTimeout","name","email","target","value"],"sources":["C:/Users/Admin/Desktop/new-ecommerce-main/client/src/components/CheckoutForm.js"],"sourcesContent":["import { CardElement, useElements, useStripe } from '@stripe/react-stripe-js'\nimport React,{useState} from 'react'\nimport { useSelector } from 'react-redux';\nimport {useNavigate} from 'react-router-dom';\nimport { useCreateOrderMutation } from '../services/appApi';\nimport { Row,Col,Alert,Form,Button, Card } from 'react-bootstrap';\n\nfunction CheckoutForm() {\n    const stripe=useStripe();\n    const elements=useElements();\n    const user=useSelector(state=>state.user);\n    const navigate=useNavigate();\n    const [alertMessage,setAlertMessage]=useState(\"\");\n    const [createOrder,{isLoading,isError,isSuccess}]=useCreateOrderMutation();\n    const [country,setCountry]=useState('');\n    const [address,setAddress]=useState(\"\");\n    const [paying,setPaying]=useState(false);\n\n\n\n    async function handlePay(e){\n        e.preventDefault();\n        if(!stripe || !elements || user.cart.count==0)\n        return;\n        setPaying(true);\n\n        const {client_secret}=await fetch('http://localhost:8080/create-payment',{\n            method:\"POST\",\n            headers:{\n                \"Content-Type\":\"application/json\",\n            },\n            body:JSON.stringify({amount:user.cart.total}),\n        }).then((res)=>res.json());\n        \n        // const k=elements.getElement(CardElement);\n        // console.log(k);\n\n\n        const {paymentIntent,error}=await stripe.confirmCardPayment(client_secret,{\n            payment_method:{\n                card:elements.getElement(CardElement),\n            },\n        }).then(function(result) {\n    // Handle result.error or result.paymentIntent\n    // console.log(result);\n        \n    return result;\n  });\n        \n        \n        setPaying(false);\n        console.log(error);\n        if(error){\n            setAlertMessage(`Payment failed: ${error.message}`);\n        }\n        if(paymentIntent){\n            \n            createOrder({userId:user._id,cart:user.cart,address,country}).then(res=>{\n                if(!isLoading && !isError){\n                    if(paymentIntent.status==='succeeded'){\n                        setAlertMessage(`Payment ${paymentIntent.status}`);\n                    }\n                    setTimeout(()=>{\n                        navigate('/orders')\n                    },2000);\n                }\n            })\n        }\n    }\n\n  return <Col className=\"cart-payment-container\">\n    <Form onSubmit={handlePay}>\n        <Row>\n            {alertMessage && <Alert>{alertMessage}</Alert>}\n       \n        <Col md={6}>\n            <Form.Group className=\"mb-3\">\n                <Form.Label>First Name</Form.Label>\n                <Form.Control type=\"text\" placeholder=\"First Name\" value={user.name} disabled />\n            </Form.Group>\n        </Col>\n        <Col md={6}>\n            <Form.Group className=\"mb-3\">\n                <Form.Label>Email</Form.Label>\n                <Form.Control type=\"email\" placeholder=\"Email\" value={user.email} disabled />\n            </Form.Group>\n        </Col>\n         </Row>\n         <Row>\n             <Col md={6}>\n                <Form.Group className=\"mb-3\">\n                    <Form.Label>Address</Form.Label>\n                    <Form.Control type=\"text\" placeholder=\"Address\" value={address} onChange={(e)=>setAddress(e.target.value)} />\n                </Form.Group>\n             </Col>\n             <Col md={6}>\n                <Form.Group className=\"mb-3\">\n                    <Form.Label>Country</Form.Label>\n                    <Form.Control type=\"text\" placeholder=\"Country\" value={country} onChange={(e)=>setCountry(e.target.value)} />\n                </Form.Group>\n             </Col>\n         </Row>\n         <label htmlFor=\"card-element\">Card</label>\n         <CardElement id=\"card-element\" />\n         <Button className=\"mt-3\" type=\"submit\" disabled={user.cart.count<=0 || paying || isSuccess}>{paying?\"Processing...\":\"Pay\"}</Button>\n    </Form>\n  </Col>\n}\n\nexport default CheckoutForm"],"mappings":"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"},"metadata":{},"sourceType":"module"}